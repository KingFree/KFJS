<?

require_once("../problem/class.php");

function ShowProblem($row) {
	global $MSG, $judge_type, $compare_type;
	$ct = $this->compare_type;
	$pt = $this->program_type;
	echo "<div><table frame=void width=100%>";
	echo "<td width=50%><div class='box'><h2>题目详细信息</h2>\n";
	echo "<table frame=box width=100% rules=all>";
	echo "<tr><td width=20%><span class=green>"._GB_Problem_Name."</span></td><td>$this->title</td>";
	echo "<td width=20%><span class=green>"._GB_Problem_English_Name."</span></td><td>$this->English</td></tr>";
	if($pt!=1) {
		echo "<tr><td width=15%><span class=green>"._GB_Time_Limit."</span></td><td>$this->time_limit s</td>";
		echo "<td width=15%><span class=green>"._GB_Memory_Limit."</span></td><td>$this->memory_limit MB</td></tr>";
	}
	echo "<tr><td><span class=green>"._GB_File_Name."</span></td><td>$this->program_filename</td>";
	echo "<td><span class=green>"._GB_Problem_Source."</span></td><td><a href='../problem/index.php?search=$this->source'>".nl2br($this->source)."</td></td></tr>";
	echo "<tr><td><span class=green>"._GB_Judge_Type."</span></td><td colspan=3>$judge_type[$pt]</td></tr>";
	echo "<tr><td><span class=green>"._GB_Compare_Type."</span></td><td colspan=3>$compare_type[$ct]</td></tr>";
	echo "</table></div></td>";
	echo "<td><table>";
	echo "<tr><div class='box' style='width: 320px; float:right;'>";
	echo "<h2>提交程序或答案</h2>";
	echo "<a href='problemstatus.php?id={$this->problem_id}'>状态</a> : 提交".$this->submit." ，解决".$this->accepted."";
	/*echo "<li>在线编写：[<a href='../problem/submitpage.php?id=$id'>"._GB_SUBMIT."</a>]</li>";
	echo "<form action='../problem/submitfile.php?id=$id' method='post'
		enctype='multipart/form-data'>
		<li><label for='file'>提交文件：</label>
		<input type='file' name='file' id='file' />
		<input type='submit' name='submit' value="._GB_SUBMIT} /></li>
		</form>";*/
	echo "<form action='../problem/submit.php?id=$this->problem_id' method=post enctype='multipart/form-data'>\n";
	if($pt==0 || $pt==2) {
		echo "<li>"; Language_Type(); echo "</li>\n";
	} else {
		echo "<li>"; Zip_File_Type(); echo "</li>\n";
	}
	if($pt==0) {
		echo "<li>"; IO_Type(); echo "</li>\n";
	}
	echo "<li><input type='file' name='file' id='file' size=20 /></li>\n";
	echo "<center><input class='lsbb' type='submit' name='submit' value="._GB_SUBMIT." class='Button'/></center>\n";
	echo "</form>\n";
	echo "</div></tr></table></td><td width=40px>&nbsp</td>\n";
	echo "</table></div>\n";

	echo "<div class='box'><h2>"._GB_Description."</h2>\n".$this->description."\n</div>\n";
	echo "<div class='box'><h2>"._GB_Input."</h2>\n".$this->input."\n</div>\n";
	echo "<div class='box'><h2>"._GB_Output."</h2>\n".$this->output."\n</div>\n";
	echo "<div class='box'><table frame=box width=80% rules=all>\n";
	echo "<tr>\n<th>"._GB_Sample_Input."</th>\n";
	echo "<th>"._GB_Sample_Output."</th>\n</tr>\n";
	echo "<tr>\n<td><pre>".($this->sample_input)."</pre></td>\n";
	echo "<td><pre>".($this->sample_output)."</pre></td>\n</tr>\n";
	echo "</table>\n</div>\n";
	echo "<div class='box'><h2>"._GB_HINT."</h2>\n".nl2br($this->hint)."\n</div>\n";;

}

function ReadProblem($pid, $cid, &$title) {
global $MSG;
$pr_flag=false;
$co_flag=false;
if ($cid=="0" && $pid!="0"){
	// practice
	$id=intval($pid);
	if (!isset($_SESSION['administrator']) && $id!=1000)
		$sql="SELECT * FROM `problem` WHERE `problem_id`=$id AND `defunct`='N' AND `problem_id` NOT IN (
				SELECT `problem_id` FROM `contest_problem` WHERE `contest_id` IN(
						SELECT `contest_id` FROM `contest` WHERE `end_time`>NOW() or `private`='1'))
			";
	else
		$sql="SELECT * FROM `problem` WHERE `problem_id`=$id";
	$pr_flag=true;
}else if($pid!="0" && $cid!="0"){
	// contest
	$cid=intval($cid);
	$pid=intval($pid);
	if (!isset($_SESSION['administrator']))
		$sql="SELECT langmask FROM `contest` WHERE `defunct`='N' AND `contest_id`=$cid AND `start_time`<NOW()";
	else
		$sql="SELECT langmask FROM `contest` WHERE `defunct`='N' AND `contest_id`=$cid";
	$result=mysql_query($sql);
	$rows_cnt=mysql_num_rows($result);
	$ok_cnt=$rows_cnt==1;
	$row=mysql_fetch_row($result);
	$langmask=$row[0];
	mysql_free_result($result);
	if ($ok_cnt!=1){
		$this->title=_GB_NO_SUCH_CONTEST;
		return "0";
	}else{
		// started
		$sql="SELECT * FROM `problem` WHERE `defunct`='N' AND `problem_id`=(
			SELECT `problem_id` FROM `contest_problem` WHERE `contest_id`=$cid AND `num`=$pid
			)";
	}
	// public
	$this->title=_GB_NOT_INVITED;
	return "0";
	$co_flag=true;
}
else
	return "0";
$result=mysql_query($sql);
if (mysql_num_rows($result)!=1){
	$id=intval($pid);
	mysql_free_result($result);
	$sql="SELECT  contest.`contest_id` , contest.`title`,contest_problem.num FROM `contest_problem`,`contest` WHERE contest.contest_id=contest_problem.contest_id and `problem_id`=$this->program_id and defunct='N'  ORDER BY `num`";
	//echo $sql;
	$result=mysql_query($sql);
	if($i=mysql_num_rows($result)){
		for (;$i>0;$i--){
			$row=mysql_fetch_row($result);
			$title=$row[0].$row[1];
			echo "<a href=../problem/problem.php?cid=$row[0]&pid=$row[2]>Contest $row[0]:$row[1]</a><br>";
		}
	} else {
		$title=_GB_NO_SUCH_PROBLEM;
		return "0";
	}
} else {
	$row=mysql_fetch_object($result);
	if ($pr_flag){
		$title=$row->problem_id.':'.$row->title;
	}else{

		$title=$PID[$pid].':'.$row->title;
		$id = $cid;
	}
	return $row;
}
}


?>
